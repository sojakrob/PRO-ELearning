\documentclass[11pt,oneside,a4paper]{book}
%\documentclass[czech, 11pt, twoside, a4paper]{book}

\usepackage[czech, english]{babel}
\usepackage[T1]{fontenc}
\usepackage[cp1250]{inputenc}

\usepackage{graphicx}
\usepackage{indentfirst}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{pifont}
\usepackage{array}
\usepackage{footmisc}
\usepackage{url}
\usepackage{caption}

\usepackage{k336_thesis_macros}

\usepackage{sojakrob_macros}

\lstset
{
language=CSharp,
classoffset=2,
morekeywords={ActionResult, UserTypes, AuthorizeUserType, PermissionException, UserPermissions, Form, ArgumentException, ArgumentNullException, UserPermissions, StudentPermissions, LectorPermissions, AdministratorPermissions, IUnityContainerAccessor, IUnityContainer, MvcApplication, HttpApplication, UnityContainerFactory, ControllerBuilder, UnityControllerFactory, DefaultControllerFactory, IController, Type, RequestContext, IAuthenticationContext, WebAuthenticationContext, Dependency}
}

\newcommand\TypeOfWork{Bakaláøská práce}  \typeout{Bakalarska prace}
\newcommand\StudProgram{Softwarové technologie a~management, Bakaláøský}
\newcommand\StudBranch{Softwarové inženýrství}

\newcommand\WorkTitle{E-learningový systém se zamìøením na testování}
\newcommand\FirstandFamilyName{Robert Soják}
\newcommand\Supervisor{Ing. Ondøej Macek}

\usepackage[
pdftitle={\WorkTitle},
pdfauthor={\FirstandFamilyName},
bookmarks=true,
colorlinks=true,
breaklinks=true,
urlcolor=red,
citecolor=blue,
linkcolor=blue,
%urlcolor=black,
%citecolor=black,
%linkcolor=black,
unicode=true,
]{hyperref}

\usepackage[square, numbers]{natbib}
%\usepackage{url}
%\DeclareUrlCommand\url{\def\UrlLeft{<}\def\UrlRight{>}\urlstyle{tt}}  %rm/sf/tt
%\renewcommand{\emph}[1]{\textsl{#1}}    % melo by byt kurziva nebo sklonene,
\let\oldUrl\url
\renewcommand\url[1]{<\texttt{\oldUrl{#1}}>}


\begin{document}
\selectlanguage{czech}

\iflanguage{czech}{
	 \typeout{************************************************}
	 \typeout{Zvoleny jazyk: cestina}
	 \typeout{Typ prace: \TypeOfWork}
	 \typeout{Studijni program: \StudProgram}
	 \typeout{Obor: \StudBranch}
	 \typeout{Jmeno: \FirstandFamilyName}
	 \typeout{Nazev prace: \WorkTitle}
	 \typeout{Vedouci prace: \Supervisor}
	 \typeout{***************************************************}
	 \newcommand\Department{Katedra poèítaèù}
	 \newcommand\Faculty{Fakulta elektrotechnická}
	 \newcommand\University{Èeské vysoké uèení technické v~Praze}
	 \newcommand\labelSupervisor{Vedoucí práce}
	 \newcommand\labelStudProgram{Studijní program}
	 \newcommand\labelStudBranch{Obor}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%    Titulni stranka / Title page 

\coverpagestarts

%%%%%%%%%%%%%%%%%%%%%%%%%%%    Podekovani / Acknowledgements 

\acknowledgements

\noindent
Na tomto místì bych chtìl podìkovat své rodinì za neustálou podporu pøi studiu. Dále dìkuji Ing. Ondøeji Mackovi za vedení práce, hlavnì za pravidelné podnìtné konzultace a~poskytnutí zadání tohoto zajímavého projektu.

%%%%%%%%%%%%%%%%%%%%%%%%%%%   Prohlaseni / Declaration 

\declaration{V~Praze dne 24.\,5.\,2012}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%    Abstract 
 
\abstractpage

This thesis deals with the analysis, development and testing of e-learning system to support teaching. The emphasis is on creating and filling tests with a~special type added, a~learning test. The portal also cooperates with some Google services, such as Docs and Groups. Result of the work is a~web application that will be used for education by non-profit organization and for teaching in high school.

\vglue60mm
\noindent{\Huge \textbf{Abstrakt}}
\vskip 2.75\baselineskip

\noindent

Tato práce se zabývá analýzou, vývojem a~následným testováním e-learningového systému pro podporu výuky. Dùraz je kladen na tvorbu a~vyplòování testù s~pøidaným speciálním typem, nauèným testem. Portál také spolupracuje s~nìkterými Google službami, jako jsou Dokumenty a~Skupiny. Výsledkem práce je webová aplikace, která bude využívána ve vzdìlávací neziskové organizaci a~k~výuce na støední škole.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Obsah / Table of Contents 

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Seznam obrazku / List of Figures 

\listoffigures

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Seznam tabulek / List of Tables

\listoftables

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  Seznam zdrojovych kodu / List of Source Codes

\lstlistoflistings

%**************************************************************

\mainbodystarts
% horizontalnÃ­ mezera mezi dvema odstavci
%\parskip=5pt
%11.12.2008 parskip + tolerance
\normalfont
\parskip=0.2\baselineskip plus 0.2\baselineskip minus 0.1\baselineskip


%*****************************************************************************
\chapter{Úvod}

Tento projekt e-learningového\footnote{Vzdìlávání za pomoci moderních elektronických informaèních a~komunikaèních technologií} systému vznikl na základì poptávky neziskové organizace. Má sloužit jako nástroj pro nauèné testování úèastníkù (dále \textit{studentù}) kurzù, které organizace poøádá.

V~souèasné dobì organizace využívá pro testování Google Formuláøù\footnote{Názvem Google Formuláø zde znaèím formuláø tabulkového procesoru z~rodiny Google Dokumentù} \cite{GoogleDocuments} s~testovými otázkami, kde student vybírá právì jednu odpovìï z~nìkolika možných. Skrze automaticky generovanou tabulku odpovìdí jednotlivých studentù je sice koordinátor kurzu (dále \textit{lektor}) schopen vyhodnotit správnost odpovìdí, ale to je vše, co mu aplikace Formuláøù umožòuje. Výsledky je lektor nucen ruènì vyhodnotit a~danému studentovi nastínit správné odpovìdi nebo ho alespoò odkázat na související kapitolu v~uèebním materiálu (dále \textit{skripta}).

Pro kategorizaci studentù a~pøíslušných lektorù je v~organizaci využito Google Skupin.

\section{Cíl projektu}

Cílem projektu je vyvinout portál pro podporu výuky. Jeho hlavní funkcí by mìla být tvorba a~vyplòování nauèných testù urèených skupinám studentù. Systém by mìl také podporovat tvorbu a~správu elektronických skript.

Jakožto bakaláøská práce by mìl projekt také ukázat mou schopnost samostatnì øešit daný problém a~ukázát, jak umím uplatnit nabyté znalosti a~využít moderních technologií pøi jeho realizaci.

\section{Využití}

Výsledný systém by mìl být využit ve zmínìné poptávající neziskové organizace.

Má ale i~širší využití, protože dává za vznik univerzálnímu e-learningovému portálu. Systém nauèných testù (rozebrán ve~\ref{sec:Popis problému} a~\ref{sec:Typy formuláøù}) je zde svým zpùsobem originální a~odlišuje portál od ostatních aplikací tohoto typu.

Já osobnì bych chtìl portál využít jako nástroj pro podporu výuky studentù informatiky na gymnáziu, kde pùsobím jako uèitel. Oèekávám od nìj efektivní pomoc pøi tvorbì a~známkování testù a~sdílení studijních materiálù.

Mùže být pøínosem i~pro další pøedmìty jako jednoduše ovladatelný nástroj pro tvorbu tištìných testù èi dotazníkù, které jsou vìtšinou tìžkopádnì tvoøeny v~textovém procesoru. Nastavil by se tím i~jednotný vzhled, který má každý kantor odlišný.

\section{Obsah práce}

V~této práci se nejprve vìnuji analýze výsledného systému, kde ukazuji svùj postup pøi shromažïování požadavkù, rešerši podobných systémù a~promýšlení celkové funkcionality. Poté zde pøedstavuji návrh architektury systému a~potøebných entit. Na to navazuji popisem implementace, kde zmiòuji nìkteré postupy a~konkrétní øešení nìkterých èástí aplikace. Poté se vìnuji testování a~nasazení hotového portálu. Nakonec uvádím možná rozšíøení a~celkové zhodnocení.
 

%*****************************************************************************
\chapter{Analýza}
\label{chp:Analýza}

V~této kapitole nejdøíve shromažïuji a~popisuji požadavky na výsledný systém. Poté se vìnuji rešerši již existujících systémù, abych získal pøedstavu, co v~souèasné dobì nabízejí a~jak vypadají. To napomùže k~jasnìjšímu pohledu na možná øešení pro splnìní daných požadavkù. Dále rozebírám konkrétní øešení mého systému.

\section{Popis problému}
\label{sec:Popis problému}

Jak již vyplynulo z~úvodu, organizace potøebuje aplikaci pro tvorbu, vyplnìní, okamžité vyhodnocení a~okomentování testù. Ty zde znaèím jako \textit{nauèné testy}.

Lektor kurzu vytvoøí šablonu testu s~otázkami o~nìkolika možných odpovìdích. Ke každé otázce by mìl mít možnost napsat slovní komentáø, ve kterém mùže nastínit, proè je daná odpovìï správnì nebo špatnì a~pøípadnì odkázat na studijní materiál, který danou problematiku vysvìtluje. Každá otázka k~sobì mùže vázat otázky alternativní, které test inovují pøi vyplòování stejného testu vícekrát.

Student by mìl mít vždy pøehled o~dostupných testech, které jsou urèené pro kurzy, do nichž je zaøazen. Po konkrétním výbìru se pro nìho test vygeneruje z~dostupných otázek a~jejich alternativ. Vždy, když testovaný oznaèí svou odpovìï, zobrazení se vysvìtlení správné odpovìdi a~dojde k~jejímu viditelnému zvýraznìní. Po vyplnìní celého testu èi pouze jeho èásti má student možnost odeslat svùj výsledek nadøízenému lektorovi. Ten má ve výsledku pøehled, jak na tom jeho svìøenci se znalostmi jsou.

\section{Požadavky na systém}
\label{sec:Požadavky na systém}

Požadavky na výsledný e-learningový systém sestávají ze základních požadavkù zadávající organizace (\ref{sec:Popis problému}) a~z~rozšiøujících požadavkù. Rozšiøující požadavky byly sestaveny na základì obecných požadavkù na systém takového typu a~z~inspirací zmínìných v~rešerši v~následující sekci~\ref{sec:Rešerše existujících øešení}. Díky tìmto rozšiøujícím požadavkùm by mìl vzniknout zmínìný komplexnìjší univerzální e-learningový systém.

\subsection{Požadavky zadavatele}
\label{subs:Požadavky zadavatele}

\subsubsection{Funkèní požadavky}

\begin{enumerate}[FP1.] \setlength\itemindent{15pt}
\item Tvorba testù s~výbìrovými otázkami s~právì jednou správnou odpovìdí
\item Zobrazení výsledku testu a~možnost jeho odeslání lektorovi kurzu
\item Každá otázka mùže sestávat z~nìkolika variant
\label{FP:Každá otázka mùže sestávat z nìkolika variací}
\item Náhodný výbìr varianty otázky pøi generování testu
\item Zobrazení komentáøe k~právì zodpovìzené otázce (cca odstavcový)
\label{FP:Zobrazení komentáøe k právì zodpovìzené otázce (cca odstavcový)}
\item Neomezený poèet možností daný test opakovat dokud nebude zodpovìzen správnì
\item Možnost kategorizace studentù, lektorù a~pøíslušných testù do skupin
\newcounter{FPEnum} \setcounter{FPEnum}{\theenumi}
\end{enumerate}

\subsubsection{Nefunkèní požadavky}

\begin{enumerate}[NP1.] \setlength\itemindent{15pt}
\item Jednoduché ovládání, zvládnutelné bìžným uživatelem i~bez zaškolení
\label{NP:Jednoduché ovládání, pochopitelné pro bìžného uživatele i bez zaškolení}
\newcounter{NPEnum} \setcounter{NPEnum}{\theenumi}
\end{enumerate}

\subsection{Rozšiøující požadavky}

\subsubsection{Funkèní požadavky}

\begin{enumerate}[FP1.] \setlength\itemindent{15pt}
\setcounter{enumi}{\theFPEnum}
\item Rozšíøení o~více typù testù (obecnì \textit{formuláøù})
\item Možnost výbìru z~více typù otázek
\item Lektor mùže ohodnotit pøijatý formuláø
\item Podpora exportu výsledkù formuláøù do Google Formuláøù
\label{FP:Podpora exportu výsledkù formuláøù do Google Formuláøù}
\item Podpora tisku prázdných i~vyplnìných formuláøù
\item Možnost tvorby elektronických skript
\item Podpora importu studentù z~Google Skupin~\cite{GoogleGroups}
\end{enumerate}

\subsubsection{Nefunkèní požadavky}

\begin{enumerate}[NP1.] \setlength\itemindent{15pt}
\setcounter{enumi}{\theNPEnum}
\item Výsledný systém je webová aplikace postavená na ASP.NET MVC
\label{NP:Výsledný systém je webová aplikace postavená na ASP.NET MVC}
\end{enumerate}


\section{Rešerše existujících øešení}
\label{sec:Rešerše existujících øešení}

Rešerši existujících øešení e-learningových a~tvorbou formuláøù zabývajících se aplikací jsem neprovádìl za úèelem nalezení kandidáta na rozšíøení o~požadovanou funkcionalitu. Rešerši zde uvádím s~cílem prozkoumat dostupná øešení, zjistit co poskytují za služby a~pøípadnì je využít pro inspiraci. Projekt byl již od zaèátku zamýšlen pro vznik \uv{na zelené louce}. Jedním z~dùvodù je funkcionalita speciálního nauèného testu (\ref{sec:Popis problému},~\ref{sec:Typy formuláøù}). Dalším dùvodem je požadavek na jednoduché ovládaní a~zkušenost uživatelù ze zadávající spoleènosti s~prostøedím Google Formuláøù. Hlavním dùvodem je ale myslím moje snaha zapojit do vývoje znalosti softwarového inženýrství a~touha vytvoøit si systém vlastní. Nechtìl jsem jen vybrat z~pøedpøipraveného øešení s~hotovou architekturou a~pøibalit k~ní plugin pro práci s~nauènými testy.

\subsection{Google Formuláøe}

Jako Google Formuláø v~této bakaláøské práci znaèím formuláø tabulkového procesoru z~balíku Google Dokumenty~\cite{GoogleDocuments} (na Obr.~\ref{fig:Hlavní stránka Google Dokumentù}). Pomocí poskytovaného nástroje je uživateli umožnìno vytvoøit vlastní formuláø z~nìkolika možných formuláøových prvkù. Hotový formuláø lze  poté zveøejnit (zcela nebo jen pro urèitý okruh uživatelù) a~nechat jej vyplnit. Odpovìdi jsou automaticky zapisovány do tabulky, kde jsou spolu s~dalšími informacemi (napø. datum a~èas vyplnìní) pøipravené pro další analýzu.

Základní myšlenka tohoto projektu vychází právì z~Google Formuláøù (lidé od zadavele jsou na nì zvyklí), proto zde jejich rozboru vìnuji více prostoru.

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.9\textwidth]{figures/GoogleDocs}
\caption[Hlavní stránka Google Dokumentù]{Hlavní stránka Google Dokumentù -- zde je vidìt pøehledný layout a~design stránek}
\label{fig:Hlavní stránka Google Dokumentù}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/GoogleFormsSampleForm}
\caption[Ukázka Google Formuláøe: tvorba vlevo, výsledek vpravo]{Ukázka Google Formuláøe: tvorba formuláøe vlevo, výsledek je vidìt vpravo}
\label{fig:Ukázka Google Formuláøe}
\end{center}
\end{figure}

\subsubsection{Tvorba formuláøe}

Tvorba formuláøe (viditelná na obr.~\ref{fig:Ukázka Google Formuláøe}) probíhá v, øekl bych, náhledovém režimu -- uživatel vidí formuláø témìø stejnì jako koncový uživatel, jen nemùže vyplòovat odpovìdi a~otázky mùže jednotlivì upravovat. Úpravy se provádìjí dynamicky pomocí Javascriptu a~vše je automaticky ukládáno.

Otázka se skládá z~nadpisu, textu nápovìdy, volby typu otázky a~zda je otázku povinné vyplnit. Nepovinný údaj je text nápovìdy a~dokonce i~nadpis otázky, takže pøi nevyplnìní vidí koncový uživatel jen prázdné pole èi výèet odpovìdí (v~závislosti na typu otázky).

\subsubsection{Typy otázek}

Následuje výèet otázek, které lze na Google Formuláø umístit, a~použitelnost daného typu otázky ve vyvíjeném systému.

%TODO dopsat pouzitelnost:

\begin{description}
\item[Text] Krátký text, kde tázaný uživatel zapisuje odpovìï do krátkého pole input\footnote{Formuláøový element HTML}, které už dále nemìní svou velikost.
\item[Text odstavce] Pro tázaného je zobrazen jako textarea, která se pøizpùsobuje délce zapisovaného textu.
\item[Více možností] Jednoduchý výèet pomocí radio buttonù pro výbìr jedné odpovìdi.
\item[Zaškrtávací políèka] Výèet pomocí checkboxù, je možné vybrat žádnou èi více odpovìdí.
\item[Vyberte ze seznamu] Zobrazí uživateli combo box s~výètem možností. Vlastnì stejná funkènost jako Více možností, ale zabírá ménì místa, jednotlivé odpovìdi nejsou stále vidìt.
\item[Mìøítko] Umožòuje zvolení hodnoty ze zvoleného rozsahu, napøíklad 1--5. Tázanému je výbìr umožnìn pomocí radio buttonù.
\item[Møížka] V~podobì tabulky dává možnost zvolit pro každý øádek jednu hodnotu umístìnou ve sloupcích. Je zde ale omezení, sloupcù mùže být max. 5 a~pro jeden øádek nelze umožnit zvolení více hodnot najednou.
\end{description}

\subsubsection{Uživatelské rozhraní}

Protože uživatelé zadavatele jsou již zvyklí na rozhraní Google Dokumentù (na obr.~\ref{fig:Hlavní stránka Google Dokumentù} a~\ref{fig:Ukázka Google Formuláøe}) a~toto rozhraní zároveò splòuje NP\ref{NP:Jednoduché ovládání, pochopitelné pro bìžného uživatele i bez zaškolení}, mìlo by být grafické rozhraní e-learningového portálu podobné. Alespoò co se týèe rozložení a~umístìní ovládacích prvkù.

\subsection{Moodle}
\label{sec:Moodle}

Moodle~\cite{MoodleORG} je asi nejznámìjší, celosvìtovì rozšíøené prostøedí pro elektronickou podporu výuky. Je to soubor mnoha modulù, které lze využít pro sestavení a~nasazení vlastního výukového portálu. k~dispozici je jako open source pod GNU GPL\footnote{GNU General Public Licence, èesky všeobecná veøejná licence GNU} licencí.

Jeho moduly umí snad vše, co se od takového systému oèekává -- od distribuce studijních materiálù pøes tvorbu a~vyhodnocování testù po diskuzní fóra. Jakékoli další moduly lze samozøejmì doprogramovat.

Z~pohledu uživatele se mi zdá Moodle hodnì složitý. Každá obrazovka chrlí velké množství rùzných nabídek, dat a~možností. Nezkušený uživatel musí být doslova zavalen, nemluvì o~vyuèujících, kteøí mají k~dispozici podstatnì více akcí a~nastavení. Množství z~nich je pøístupné jen formou malých ikonek u~jednotlivých položek, což nutí orientovat se pomocí tooltipù. Zaèínající uživatel role studenta má ještì možnost po chvíli nalézt co hledá, ale lektor to má mnohem tìžší. Bìžní uživatelé, kteøí mají problém používat akce textového procesoru, musí být v~systému bez externí pomoci zcela ztraceni. Tomu se právì snažím v~mém systému vyhnout.

\subsubsection{Otázky do testù}

Systém Moodle pojímá otázky trochu jiným zpùsobem, než mùžeme oèekávat u~pøímoèarého tvùrce formuláøù (jako je napø. výše popisovaný Google Formuláø). Nejsou totiž vázány na jednotlivé testy, ale existují v~tzv. otázkových bankách k~urèitému kurzu. Dále se dají øadit do kategorií a~také sdílet s~dalšími kurzy a~vyuèujícími.

Ve vyvíjeném e-learningovém systému se mi ale takový zpùsob nezdá být pøínosem. Myslím si, že pro uživatele by bylo zbyteènì složité øadit otázky do množství skupin a~posléze každému formuláøi tyto skupiny otázek nastavovat.

Systém obsahuje velké množství typù otázek, které vlastnì rozšiøují základní bìžnì používanou množinu o~specifiètìjší (jako napø. spojování). Výèet pøikládám v~pøíloze \ref{fig:Typy otázek v systému Moodle}.

\subsection{Studentova Berlièka}

Studentova Berlièka je jeden z~projektù studentù ÈVUT FEL. Jedná se o~informaèní systém pro podporu výuky na škole. Vývoj zaèal bakaláøskou prací \cite{StudentovaBerlickaI} v~roce 2007 a~poté byl systém dále rozvíjen a~obohacován o~další funkcionalitu. Zamìøil jsem se na modul pro generování testù \cite{StudentovaBerlicka_ModulProGenerovaniTestu}.

Jednotlivé otázky jsou zde, podobnì jako v~Moodle, øazeny do tematických okruhù. Otázky do testu jsou vybírány z~jednoho èi více okruhù. Typy otázek jsou zde dva, slovní odpovìï a~výbìrová. 

Zajímavé je zde øešení postupu pøi tvorbì jednotlivých otázek. Otázka se mùže nacházet v~jednom z~tìchto stavù:
\begin{itemize}
\item Rozpracované
\item Mùj lokál
\item K~validaci
\item Ke schválení
\item Schválené
\end{itemize}

Jak je již z~výètu stavù zøejmé, proces tvorby je uzpùsoben pro kooperaci více uživatelù, napøíklad cvièících a~pøednášejícího. Cvièící pøipravují otázky, které následnì pøednášející schvaluje. 

Aèkoli je tento postup tvorby otázek pro vysokou školu urèitì žádoucí, pro mnou vyvíjený systém by byl nadbyteèný. v~doménì uživatelù poèítám s~jedním vedoucím skupiny, který testové otázky sám vytváøí. z~tohoto dùvodu také v~systému neøeším možné kolize pøi editování více uživateli naráz, což v~tomto modulu Studentovy Berlièky øešeno je.

\subsection{Závìr}

V~této sekci jsem popsal nìkteré systémy, které jsem prostudoval za úèelem zjištìní nabízených služeb a~zpùsobu jejich realizace. Hlavní inspirací pro základ e-learningového systému jsou pro mì Google Formuláøe. Obsahují všechny základní typy otázek potøebné pro vytváøení formuláøù a~jsou jednoduše ovladatelné. Naproti tomu Moodle mi ukazuje portál, kterému bych se blížit nechtìl. Obsahuje velké množství rùzných funkcí, kterých by v~mé cílové skupinì využilo možná procento uživatelù. Navíc je pro nì podle mne dosti složitý na ovládání.

\section{Uživatelské role}

Uživatelské role potøebné v~systému jasnì plynou již ze zadání, jsou to tyto tøi role:

\begin{description}
\item[Student] Pøedstavuje úèastníka kurzu z~domény zadavatele a~obecnì studenta využívajícího e-learningového systému. z~hlediska práv v~aplikaci je na nejnižší úrovni, tzn. všechny jeho akce se vztahují pouze k~nìmu samotnému. Mezi akce patøí napøíklad vyplòování testù dostupné pro jeho skupinu a~prohlížení si výsledkù svých testù (více v~sekci~\ref{sec:Pøípady užití}).
\item[Lektor] Lektorem je koordinátor kurzu z~domény zadavatele, vedoucí jedné èi více skupin (neboli \textit{kurzù}). Obecnì se tedy jedná o~uèitele studentù, který má na starost tvorbu testù pro jeho skupiny a~jejich následné ohodnocení.
\item[Administrátor] Uživatelská role známá asi ze všech systémù. Je to správce celého portálu a~supervizor lektorù. Jako takový má práva všech lektorù a~k~tomu dostupnou funkcionalitu pro administraci aplikace vèetnì pøidávání uživatelù a~tvorby skupin.
\end{description}

\section{Pøípady užití}
\label{sec:Pøípady užití}

Na diagramu~\ref{fig:Diagram užití} jsou zachyceny základní operace provádìné uživateli v~daných rolích zastoupených aktéry pøípadù užití. Slovní popis vybraných pøípadù užití je umístìn v~pøíloze~\ref{appendix:Pøípady užití}. Ostatní jsou realizovány pomocí Selenium testù, které jejich scénáøe jasnì vystihují. Výpis je umístìn v~tabulce~\ref{tab:TabulkaPøípadùUžití}.

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.9\textwidth]{figures/UseCaseDiagram}
\caption[Diagram užití]{Diagram užití -- zachycuje základní operace provádìné aktéry v~daných rolích}
\label{fig:Diagram užití}
\end{center}
\end{figure}

\begin{table}[h]
\begin{center}
\begin{tabular}{!{\bvline}l!{\vline}c|c!{\bvline}} \bhline
 \textbf{Pøípad užití} & \textbf{Textový popis} (\ref{appendix:Pøípady užití}) & \textbf{Selenium test} (\ref{sec:Selenium testy}) \\ \bhline
Pøihlásit se do systému & \cross & \cross \\
Odhlásit se ze systému & & \cross \\
Zobrazit formuláøe & & \cross \\
Vytvoøit nový formuláø & \cross & \cross \\
Upravit existující formuláø & & \cross \\
Pøídat/zmìnit/smazat otázku & \cross & \\
Pøiøadit formuláø skupinì & & \cross \\
Exportovat výsledky formuláøe & \cross & \\
Zobrazit dostupné formuláøe & & \cross \\
Vyplnit formuláø  & \cross & \cross \\
Zobrazit výsledky formuláøù & & \cross \\
Zobrazit skripta & & \cross \\
Vytvoøit nová skripta & & \cross \\
Upravit existující skripta & & \cross \\
Pøidat studenta do systému & & \cross \\
Pøiøadit studenta do skupiny & & \cross \\
Vytvoøit skupinu & & \cross \\
Pøídat lektora do systému & & \cross \\ \bhline
\end{tabular}
\end{center}
\caption[Rozpis použitých definic pro jednotlivé pøípady užití]{Rozpis použitých definic pro jednotlivé pøípady užití -- nìkteré pøípady jsou definovány textovým popisem, nìkteré scénáøi Selenium testù}
\label{tab:TabulkaPøípadùUžití}
\end{table}

\section{Formuláøe}
\label{sec:Formuláøe}

Formuláøe pøedstavují základní nástroj tohoto e-learningového portálu. Slouží jak lektorùm pro otestování znalostí jejich žákù, tak pro studenty samotné jako nástroj pro nauku a~zpìtnou vazbu.

Každý formuláø je možné pøiøadit do libovolného množství skupin. Vede-li lektor více skupin, má možnost urèit jako cílové skupiny formuláøe jejich podmnožinu. Studenti potom mají pøístup ke všem formuláøùm z~jim pøiøazených skupin.

Mezi další možnosti, které formuláøe obsahují, patøí napøíklad nastavení èasového limitu pro jeho vyplnìní èi zamíchání jednotlivých otázek a~odpovìdí. Více je popsáno v~sekci~\ref{sec:Možnosti nastavení formuláøù}.

Životní cyklus formuláøe (viz. Obr.~\ref{fig:Stavový diagram formuláøe}) zaèíná jeho založením lektorem a~pøechází do stavu \textit{Neaktivní editovatelný}. v~tuto chvíli jsou nastaveny možnosti formuláøe a~vytváøeny otázky. Aby byl viditelný pro studenty z~pøiøazených skupin, musí být uveden do stavu \textit{Aktivní nevyplnìný}. Pro opìtovné pozastavení formuláøe je možné pøejít zpìt do \textit{Neaktivního} stavu. v~pøípadì, že byl již test nìkým vyplnìn, pohybuje se mezi stavy \textit{Aktivní vyplnìný} a~\textit{Neaktivní needitovatelný}. v~tìchto stavech už není formuláø možné editovat. Nakonec formuláø pøechází do stavu \textit{Archivován}.

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.5\textwidth]{figures/FormStateDiagram}
\caption[Stavový diagram formuláøe]{Stavový diagram formuláøe zobrazující jeho životní cyklus}
\label{fig:Stavový diagram formuláøe}
\end{center}
\end{figure}

\pagebreak

\subsection{Typy formuláøù}
\label{sec:Typy formuláøù}

\nopagebreak[0]

Základní množinu formuláøù systému tvoøí tyto tøi typy:

\nopagebreak[0]

\begin{description}
\item[Nauèný test] Je to netradièní typ testu vycházející z~požadavkù zadavatele. Ke každé otázce je možné pøidat vysvìtlení správné odpovìdi (FP\ref{FP:Zobrazení komentáøe k právì zodpovìzené otázce (cca odstavcový)}), které je vyplòujícímu studentovi zobrazeno po oznaèení odpovìdi, kterou považuje za správnou. Test tedy plní dvì funkce, vypovídá o~souèasných znalostech studenta a~jeho pøipravenosti na možný zkouškový test. Zároveò ho opravuje a~smìruje správnou cestou. Test je možné vyplnit vícekrát. Díky alternativním otázkám (FP\ref{FP:Každá otázka mùže sestávat z nìkolika variací}) není pokaždé stejný.
\item[Zkouškový test] Toto je bìžný test pro ostré otestování studentových znalostí, jak ho známe ze všech vzdìlávacích institucí. Mùže mít navíc urèen napøíklad èasový limit pro dokonèení èí možnost více pokusù pro správné vyplnìní.
\item[Dotazník] Plní funkci bìžného dotazníku. Každý ho smí vyplnit pouze jedenkrát.
\end{description}

\subsection{Možnosti nastavení formuláøù}
\label{sec:Možnosti nastavení formuláøù}

Možnosti nastavení chování jednotlivých typù formuláøù shrnuje následující tabulka~\ref{tab:Možnosti chování formuláøù}.

\begin{table}[h]
\begin{center}
\begin{tabular}{!{\bvline}l!{\bvline}c|c|c!{\bvline}} \bhline
 & \textbf{Nauèný test} & \textbf{Zkušební test} & \textbf{Dotazník} \\ \bhline
Èas na vyplnìní & \tick & \tick & \cross \\ \hline
Zamíchaní otázek & \tick & \tick & \cross \\ \hline
Zamíchaní nabízených odpovìdí & \tick & \tick & \cross \\ \hline
Vysvìtlení správné odpovìdi & \tick & \cross & \cross \\ \hline
Možnost vyplnit vícekrát & \tick & \tick & \cross \\ \bhline
\end{tabular}
\end{center}
\caption[Možnosti chování formuláøù]{Možnosti nastavení chování formuláøù systému}
\label{tab:Možnosti chování formuláøù}
\end{table}

\section{Otázky}
\label{sec:Otázky}

Otázky tvoøí náplò formuláøù. Každá z~otázek k~sobì mùže vázat další, alternativní otázky. Když je pro studenta generován test, právì jedna alternativní otázka je vybrána. Jestliže tedy test obsahuje otázky s~více alternativami, budou jednotlivé vygenerované testy rozdílné.

Jednotlivé otázky formuláøe mohou být lektorem libovolnì tvoøeny, duplikovány, upravovány a~mazány. Ovšem jen do okamžiku, kdy je formuláø pøeveden do stavu \textit{aktivní} a~vyplnìn nìkterým ze studentù. v~tom pøípadì už otázky nesmìjí být upravovány a~mazány, aby mìli všichni stejné podmínky a~nemìnily se jim otázky \uv{pod rukama}.

Možnost duplikace otázek je zavedena hlavnì kvùli výbìrovým otázkám \ref{item:Výbìrová otázka}. Duplikací otázky tak odpadá nutnost opakovaného vkládání totožných odpovìdí.

\subsection{Typy otázek}

Množina typù jednotlivých otázek je sestavena z~potøeby zadavatele, tou je otázka výbìrová, a~ze základních potøeb univerzálního e-learningového systému. Množina tedy obsahuje 5 typù otázek, z~èehož 3 typy jsou základní. Možné další  otázky vhodné pro rozšíøení systému jsou nastínìny v~sekci~\ref{sec:Možná rozšíøení sub:Otázky}.

\begin{description}

\item[Výbìrová otázka] \label{item:Výbìrová otázka} \hfill
\begin{description}
\item[Jedna správná odpovìï] Právì jedna z~množiny nabízených odpovìdích je správná.
\item[Více správných odpovìdí] Žádná nebo více z~nabízených odpovìdí je správná.
\end{description}

\item[Textová otázka] \hfill
\begin{description}
\item[Krátká] Od vyplòujícího studenta se oèekává jednoslovná èi jednovìtná odpovìï.
\item[Dlouhá] Zde se oèekává vyèerpávající odpovìï, tzn. jedna a~více vìt.
\end{description}
\item[Rozsahová otázka] Odpovìï je tøeba vybrat z~definovaného rozsahu, napø. známka 1--5, hodnocení 0--10. Tento typ otázky je hlavnì pro potøebu dotazníku.
\end{description}

\section{Skripta}
\label{sec:Skripta}

Skripta hrají v~systému roli elektronických uèebních materiálù. Kategorizována jsou stejnì jako formuláøe do skupin existujících v~systému, takže studenti mají k~dispozici materiály výhradnì k~jim pøiøazeným kurzùm. Skripta by mìla být vytváøena pøevážnì lektory pro studenty. Možnost jejich tvorby ale není studentùm odepøena, mohou je využít napøíklad pro tvorbu osobních zápiskù z~hodin. Mají také možnost vytvoøená skripta zveøejnit pro ostatní èleny skupiny.

Skripta je možné formátovat do strukturované podoby, tzn. možnost tvorby nadpisù, odstavcù, odkazù, tabulek, možnost volby stylu písma a~dalšího. k~tomuto úèelu by mìl být k~dispozici editor používající Wiki znaèkování\footnote{Syntaxe a~klíèová slova využívaná k~formátování textu na stránce}, která je snad pro vìtšinu uživatelù pochopitelná a~lehce nauèitelná. s~pomocí tlaèítek pro automatické formátování vybraného textu nemusí mít ani uživatel potøebu proèítat dokumentaci k~používání daného Wiki znaèkování.

\chapter{Návrh}

\section{Architektura systému}
\label{sec:Architektura systému}

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.8\textwidth]{figures/Architecture}
\caption[Architektura systému]{Architektura systému -- tøívrstvá architektura s~vrstvou datovou, bussines a~\uv{prezentaèní} vrstvou postavenou na MVC vzoru}
\label{fig:Architektura systému}
\end{center}
\end{figure}

Architektura systému (Obr.~\ref{fig:Architektura systému}) je spojením architektury tøívrstvé a~MVC\footnote{Model View Controller} (Obr.~\ref{fig:Architektura MVC}). Použití MVC jasnì vyplývá již z~NP\ref{NP:Výsledný systém je webová aplikace postavená na ASP.NET MVC}. Ovšem architektura MVC sama o~sobì podle mne o~celkové struktuøe systému nevypovídá mnoho. Pod pojem Model totiž skrývá nìkolik rùznorodých komponent systému, konkrétnì napøíklad business logiku (jejíž èást ale bývá také v~Controlleru) a~datové uložištì. a~protože Model, View i~Controller bývají v~praxi velmi provázané, je nemožné jednu z~komponent vymìnit za jinou s~rozdílnou implementací bez zásahu do ostatních.

Já tedy využívám MVC jako \uv{prezentaèní} vrstvu z~pohledu tøívrstvé architektury. Mohu totiž tuto vrstvu kdykoli vymìnit napøíklad za Windows Forms, èímž vznikne desktopová aplikace využívající totožnou business a~datovou vrstvu.

Business vrstva je již standartní vrstva tøívrstvé architektury, která obstarává veškerou aplikaèní logiku a~zprostøedkovává prezentaèní vrstvì zpracovaná data.

Datová vrstva obsahuje celý datový model systému a~také komponenty potøebné pro CRUD\footnote{Create, Read, Update \& Delete - ètyøi základní operace datového uložištì} operace s~tìmito daty.

\section{Datová vrstva}

Na Meta modelu (Obr.~\ref{fig:Meta model}) jsou vidìt základní entity modelovaného systému a~vztahy mezi nimi. Za zmínku stojí \icode{FormTemplate} a~\icode{QuestionGroup}. První jmenovaná entita zastupuje šablonu formuláøe, na jejímž základì jsou generovány jednotlivé instance (neboli konkrétní sestavy) formuláøe, pøedstavující unikátní formuláø urèený k~jednomu vyplnìní studentem. \icode{FormTemplate} obsahuje kolekci druhé jmenované entity \icode{QuestionGroup}, což je skupina otázek (otázka a~její alternativy, viz. \ref{sec:Otázky}). Do instance formuláøe se vybírá právì jedna otázka z~této množiny.

Návrhový model na obrázku \ref{fig:Design model datové vrstvy} ukazuje podrobnìjší návrh objektù datové vrstvy. u~jednotlivých objektù jsou vypsány jejich základní vlastnosti, se kterými by mìl systém umìt pracovat pro dosažení požadované funkcionality analyzované v~kapitole \ref{chp:Analýza}.

Mimo jiné bylo nutné pøidat vlastní objekt instance otázky (\icode{QuestionInstance}), který je tøeba pro zachycení pozice otázky ve formuláøi (jelikož je možné pøi generování instance testu nechat otázky promíchat). Další zanesenou entitou je \icode{Answer} zastupující odpovìï na otázku a~\icode{FormInstanceEvaluation} tvoøící ohodnocení instance formuláøe. Pøibyl také objekt \icode{ChoiceItem}, což je položka možné odpovìdi na otázku typu výbìrová (\ref{item:Výbìrová otázka}). 

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.9\textwidth]{figures/MetaModel}
\caption[Meta model]{Meta model zachycující základní entity modelovaného systému a~vztahy mezi nimi}
\label{fig:Meta model}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/DesignModel}
\caption[Návrhový model datové vrstvy]{Návrhový model datové vrstvy ukazující podrobnìjší návrh objektù datové vrstvy}
\label{fig:Design model datové vrstvy}
\end{center}
\end{figure}

\section{Business vrstva}

Jak již bylo øeèeno výše, business vrstva obsahuje veškerou logiku tohoto e-learningového systému a~operace pro práci s~daty získané pomocí datové vrstvy. Jelikož obsahuje rùznorodé komponenty, je rozdìlena do nìkolika balíèkù, které jsou i~se svým obsahem patrné z~diagramu na obrázku \ref{fig:BusinessPackages}.

\subsection{Rozpis balíèkù}

\begin{description}
\item[Managers] Balíèek obsahující tøídy, které nazývám \uv{manažery}. Mají za úkol poskytovat funkcionalitu pro práci s~jim svìøenou datovou entitou z~datové vrstvy, napøíklad \icode{TextBookManager} obsahuje implementaci spojenou se skripty a~\icode{GroupManager} se skupinami.
\item[Permissions] Zde je místo pro práva-definující tøídy. o~implementaci s~nimi spojené je více popsáno v~sekci \ref{sec:Práva uživatelù}.
\item[Storages] V~tomto balièku jsou umístìny tøídy týkající se ukládacích prostorù. Lokální pro odkládání dat napø. pøi exportu a~\icode{WebStorage} pro zapouzdøení pøístupu k~datùm v~databázi ve webovém prostøedí.
\item[Reporting] Balíèek sloužící k~reportování výsledkù vyplnìných formuláøù.
\item[ImportExport] V~ImportExport balíèku se nacházejí tøídy pro import dat do systému a~export ze systému. Vnoøený balíèek Google se vìnuje pøedávání dat s~Google službami.
\item[Interfaces] Obecný balíèek pro rùzná rozhraní, která není nutné dìlit do vìtších kontextù.
\item[Exceptions] Zde se nacházejí specifické výjimky systému.
\end{description}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/BusinessPackages}
\caption[Balíèky business vrstvy]{Balíèky business vrstvy obsahující rùznorodé komponenty pro obstarávání veškeré aplikaèní logiky}
\label{fig:BusinessPackages}
\end{center}
\end{figure}

\section{ASP.NET MVC vrstva}

Tato vrstva staví na modelu MVC (na Obr. \ref{fig:Architektura MVC}) tvoøícím podstatu technologie ASP.NET MVC. Základem je zde tedy view, controller a~model.

Pohledy (views) jsou odpovìdné za tvorbu grafického rozhraní pro uživatele, které tvoøí na základì dat získaných od controlleru. v~ASP standartnì odpovídá jméno pohledu jménu metody controlleru, kterou je pohled vyvoláván. Vìtšina pohledù sestává z~nìkolika parciálních (èásteèných) pohledù, které jsou využívány na nìkolika místech.

Controllery zde zastávají funkci prostøedníka mezi pohledy a~business vrstvou. Obstarávají pro pohledy relevantní data a~pøi vyvolání akce uživatelem tuto akci propagují do aplikaèní logiky.

Model z~MVC trojice v~této vrstvì není zcela standartní, jak jsem již pøiblížil ve \ref{sec:Architektura systému}. Podle MVC terminologie pod pojem model patøí má business i~datová vrstva. Proto v~této vrstvì mluvím spíše o~Data modelu (což je vidìt na diagramu~\ref{fig:Architektura systému}), který obsahuje datové entity urèené k~pøedávání mezi pohledem a~controllerem. Jejich smyslem je mimo jiné odstínit závislost pohledù na konkrétních vlastnostech datových typù datové vrstvy a~vytvoøit další vlastnosti plnìné aplikaèní logikou.

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.5\textwidth]{figures/MVC}
\caption[Architektura MVC]{Architektura MVC -- View, Controller, Model a~znázornìní komunikace mezi nimi}
\label{fig:Architektura MVC}
\end{center}
\end{figure}

\section{Technologie a~frameworky}

\subsection{\CSharp~ASP.NET MVC 4.0}
\label{subs:ASP.NET MVC 4.0}

Tento projekt vyvíjím v~jazyce \CSharp~ve vývojovém prostøedí Visual Studio 2010. Protože se jedná a~webovì orientované øešení, je využito ASP.NET~\cite{ASPNETOfficial}. Ze tøí\footnote{Jsou to pøístupy Web Pages, Web Forms a~MVC. Více lze nalézt napøíklad na~\cite{ASPNETOfficial3Approaches}} pøístupù pro tvorbu s~ASP.NET používám MVC verze 4.0.

\subsection{ADO.NET Entity Framework}
\label{sec:Entity Framework}

Entity Framework je ORM\footnote{Objektovì relaèní mapování, technika pro pøevod dat mezi relaèní databází a~objekty objektovì orientovaného programovacího jazyka} framework z~rodiny ADO.NET. Slouží pro práci s~daty v~relaèním databázovém uložišti. Vývoj zcela odstiòuje napøíklad od ruèního psaní SQL dotazù a~pøipojování k~DB. Framework je velice jednoduše a~rychle použitelný. Doporuèil bych jeho využití v~malých a~støednì velkých aplikacích, kde není až tak velký poèet dotazù na DB a~tyto dotazy nemusí být optimalizovány do posledního klíèového slova. Více o~využití EF v~tomto projektu uvádím v~sekci~\ref{sec:Implementace-Datová vrstva}.

\subsection{HTML, CSS}

Jelikož je projekt webová aplikace, základ uživatelského rozhraní tvoøí HTML a~CSS. Kaskádové styly jsou optimalizovány pro prohlížeè Google Chrome, avšak kontrolovány byly i~ve Firefoxu a~Opeøe. Dodatek k~nynìjšímu stavu viz. závìr~\ref{sec:Další vývoj}.

\subsection{Javascript, jQuery}

Pro zajištìní dodateèné interaktivity a~operací aplikace na stranì uživatele je využito Javascriptu a~nadstavbového frameworku jQuery~\cite{JQuery}. Pro zjednodušení práce s~Cookies (využité napø. pro uchování seznamu srolovaných otázek pøi editaci formuláøe) je využito pluginu Cookie~\cite{jQueryCookiePlugin}.

\subsection{MarkItUp a~Wiki .NET Parser}

Formátování skript~(sekce \ref{sec:Skripta}) je øešeno pomocí Wiki znaèkování. Aby mìl uživatel znaèkování co nejvíce ulehèené, je využito editoru MarkItUp!~\cite{MarkItUp}. Je to velice pøizpùsobitelný a~flexibilní editor jakéhokoli kódu. v~tomto pøípadì upravený pro úpravu Wiki syntaxe.

Pro pøevod stránky s~Wiki znaèkováním do HTML je využit Wiki .NET Parser~II~\cite{WikiNETParser}. Jeho použití je velice jednoduché, staèí zavolat metodu \icode{ConvertToHTML} s~parametrem Wiki-formátovaného textu. Vrácenou hodnotou je pak pøipravený HTML kód.

\subsection{Google Data API}

K~exportu výsledkù formuláøe do Google Formuláøù~(FP\ref{FP:Podpora exportu výsledkù formuláøù do Google Formuláøù}) se pøedpokládá využítí Google API. Pro tento úèel existuje knihovna Google Data API .NET Client Library~\cite{GoogleDataAPI}, která obsahuje funkcionalitu pro volání Google API z~prostøedí .NET.

%*****************************************************************************
\chapter{Implementace}

\section{Datová vrstva}
\label{sec:Implementace-Datová vrstva}

Pro implementaci datové vrstvy aplikace jsem použil Entity Framework (viz.~\ref{sec:Entity Framework}). Zvolil jsem pøístup Model First Development. Podle mne je to výborný kompromis mezi Code First a~Database First øízeném vývoji. Mám díky nìmu plnou kontrolu nad strukturou vytváøené databáze a~zároveò nad generovanými tøídami.

Model First Development je jedním z~postupù pøi vývoji datové vrstvy. Zaplòuje mezeru mezi Code First a~Database First vývoji. Pøi Code First postupu se nejdøíve napíše kód všech datových entit a~Entity Framework poté automaticky vygeneruje strukturu potøebné databáze. Naopak pøi Database First vývoji se nejdøíve vytvoøí kompletní databáze, na jejímž základì vygeneruje EF odpovídající tøídy v~kódu. Pøi Model First se nevytváøí ani struktura DB, ani samotný kód, ale vše se zakresluje do diagramu Entity Data Modelu~(\ref{fig:Entity Data Model}). Vývojáø je tedy po celou dobu v~roli architekta systému, protože se vlastnì stále pohybuje v~UML diagramu. Pøesto má možnost, díky množství nastavení, ovlivòovat struktutu generované DB i~generovaného kódu tøíd.

Všechny možné nedostatky skriptu databáze lze vyøešit pøidáním databázového projektu a~importem vygenerovaného skriptu do nìho. V~takovém projektu lze mít další skripty napøíklad pro spuštìní pøed a~po vyvolání hlavního skriptu. Post-deployment skriptu využívám také pro automatické vytvoøení základních záznamù (èíselníky, administrátor), èímž mne každé nasazení databáze stojí pouhé dvì kliknutí myší.

Potøebné úpravy generovaného kódu tøíd lze jednoduše provést pomocí èásteèných (partial) tøíd. Napøíklad u~entit obsahujících hodnotu èíselníku toho využívám pro navázání enumerátoru v~kódu, pøedstavujícího daný databázový èíselník. Nikde jinde v~kódu pak tedy nemusím øešit žádné èíselníkové objekty a~identifikátory vztahující se k~databázi.

Ve své implementaci datové vrstvy nevyužívám možnosti nastavit kaskádní mazání položek v~databázi. Všechna taková mazání je nutné provádìt \uv{ruènì} v~business vrstvì. Je to hlavnì z~dùvodu zamezení vzniku rùzných chyb z~nepozornosti a~neprostudování všech možných relací pøed zásahem do kódu. Je tedy nutné mít v~metodách pro mazání pár øádkù kódu navíc, ale tím jsou všechny vykonávané akce patrné a~pøípadnì lze nìjaké další akce pøi mazání vyvolat.

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/EntityDataModel}
\caption[Entity Data Model]{Entity Data Model -- diagram celé datové vrstvy vytvoøený pomocí Entity Frameworku}
\label{fig:Entity Data Model}
\end{center}
\end{figure}

\clearpage
\section{Práva uživatelù}
\label{sec:Práva uživatelù}

Práva uživatelù se v~tomto systému odvíjí od role, ve které se daný uživatel nachází. Není zde potøeba nastavovat každému uživateli specifická práva, protože role pøesnì definují jeho vztah k~informacím v~systému a~operacím s~nimi. To je rozdíl napøíklad od vnitrofiremních IS, kde je potøeba každému uživateli mìnit práva pro pøístup k~datùm a~jednotlivým modulùm.

Pøesto jsou ale práva implementována tak, aby v~pøípadì budoucí potøeby (a~zde také pro ukázkové akademické úèely) bylo velmi jednoduché pøiøadit každému uživateli práva nezávisle na jeho systémové roli. Abych dále mohl uvést podrobnìjší detaily, uvádím zde ukázku implementace oprávnìní uživatele:

\begin{lstlisting}[caption={[Ukázka \icode{UserPermissions} a~souvisejících tøíd ]Ukázka \icode{UserPermissions} a~souvisejících tøíd -- ukazuje implementaci oprávnìní uživatelských rolí v~systému}, label={code:Ukázka UserPermissions}]
namespace ELearning.Business.Permissions
{
	public class U``serPermissions
	{
		// ...
		public virtual bool Group_List_All { get { return false; } }
		public virtual bool Group_CreateEdit { get { return false; } }
		public virtual bool Group_Delete { get { return false; } }
		// ...
		internal static UserPermissions Get(UserTypes userType)
		{
			switch (userType)
			{
				// ...
				case UserTypes.Administrator:
					return new AdministratorPermissions();
				// ...
			}
		}
	}
	public class S``tudentPermissions : UserPermissions { /* ... */ }
	public class L``ectorPermissions : StudentPermissions { /* ... */ }
	public class A``dministratorPermissions : LectorPermissions
	{
		// ...
		public override bool Group_List_All { get { return true; } }
		public override bool Group_CreateEdit { get { return true; } }
		public override bool Group_Delete { get { return true; } }
		// ...
	}
\end{lstlisting}

Jak je z~kódu~\ref{code:Ukázka UserPermissions} patrné, všechny dílèí práva (v~ukázce práva na operace s~uživatelskými skupinami) jsou umístìna do vlastní property. Vrácení správné hodnoty v~závislosti na roli uživatele je øešeno pomocí dìdiènosti. Pro úpravu práv, aby fungovala pro jednotlivé uživatele nezávisle na rolích, je potøeba jen pøidat vlastní tøídu pro vrácení hodnoty získané ne \uv{natvrdo}, ale z~relevantního záznamu z~databáze.


\section{Bezpeènost}

Na bezpeènost této webové aplikace se dívám ze dvou smìrù, a~to z~hlediska bezpeènosti pøenášených dat mezi klientem a~serverem a~z~hlediska bezpeènosti pøi práci uživatele v~aplikaci. Jsou zde možná i~další hlediska, napøíklad komunikace webového serveru s~databázovým serverem, ale tu zde myslím není tøeba rozebírat. Pro jednoduchost pøedpokládám, že aplikace i~databáze bìží na totožném serveru.

\subsection{Bezpeènost pøenášených dat}

Jedná se o~bezpeènost pøenosu veškerých dat, která se pøenášejí po síti (a už po LAN èi po internetu), když uživatel interaguje s~aplikací. Nejdùležitìjší je asi moment, kdy se uživatel do aplikace pøihlašuje. Odesílá své uživatelské jméno a~heslo, díky èemuž je systémem identifikován a~autorizován k~provádìní jednotlivých akcí.

Když pøihlašovací údaje zachytí útoèník (útokem známým jako MITM\footnote{Man In The Middle -- útoèník, který odposlouchává a~pøípadnì mìní komunikaci}), získává tím identitu pravého uživatele a~pøístup ke všem jeho datùm v~systému. To dìlá tento útok nejnebezpeènìjším ze všech. Když se navíc útoèníkovi podaøí získat pøihlašovací údaje administrátora systému, dostane se rázem k~veškerým datùm v~systému. Navíc pro export do Google Formuláøù musí uživatel zadat údaje ke svému Google úètu, takže v~pøípadì odposlechnutí dojde k~narušení bezpeènosti i~ve zcela jiném systému než je tento.

I~když se ale útoèníkovi nepodaøí zachytit pøihlašovací údaje, stále má možnost se hodnì vìcí dozvìdìt. Pøi zachycení komunikace vidí všechny informace, které si uživatel v~danou chvíli prohlíží èi zadává.

Naštìstí se dá útokùm lehce zabránit, a~to zavedením komunikace pøes HTTPS namísto HTTP, což se øeší na úrovni webového serveru. Pøi komunikaci pøes HTTPS je využito protokolu SSL, který s~využitím serverového certifikátu veškerou komunikaci šifruje.

\subsection{Bezpeènost pøi práci v~aplikaci}

Zde se jedná o~bezpeènost interakce uživatele s~rozhraním aplikace, tzn. zobrazování informací, pøidávání a~úprava dat, to vše podmínìné stupnìm oprávnìní uživatele a~jeho pøiøazením do skupin.

V~aplikaci je implementováno \uv{dvoustupòové} zabezpeèení. Prvním stupnìm je kontrola oprávnìní uživatele na úrovni prezentaèní vrstvy. Pøístup na jednotlivé stránky je regulován pomocí zavedeného atributu \icode{AuthorizeUserType}, který jsem pøipojil ke všem metodám controllerù. Pøedáním parametru \icode{UserType} je urèen nejnižší stupeò oprávnìní pro pøístup na danou url zastupovanou názvem metody. Pøi neoprávnìném pokusu o~pøístup na url je atributem vyhozena výjimka typu \icode{PermissionException}, která má za následek zobrazení varovného hlášení (Obr. \ref{fig:PermissionException}). Bìžnì by se uživatel na takovouto url vùbec dostat nemìl, protože stejná politika je implementována ve views, èímž adresa takové url není uživateli dostupná.

\pagebreak

\begin{lstlisting}[caption={[Použití atributu \icode{AuthorizeUserType}]Použití atributu \icode{AuthorizeUserType} na akci controlleru}]
[AuthorizeUserType(UserType = UserTypes.Lector)]
public ActionResult Create()
{
	// ...
}
\end{lstlisting}

Druhým stupnìm je kontrola oprávnìní v~samotné business vrstvì. Všechny operace nad daty zde obsahují ovìøení práva na vykonání pomocí \icode{UserPermissions}, testují zda požadovanou položku uživatel vytvoøil èi patøí do jeho skupiny apod. Pokud práva nemá, vznikne opìt výjimka \icode{PermissionException}.

\begin{lstlisting}[caption={[Ovìøování práv v~business vrstvì]Ovìøování oprávnìní pøihlášeného uživatele v~business\\vrstvì -- pøi neoprávnìném pøístupu je v~aplikaci vyvolána chyba typu\\ \icode{PermissionException}}]
public Form GetForm(int id)
{
	var result = GetSingle(f => f.ID == id);
	if (result == null)
	{
		if (Context.F``orm.Count(f => f.ID == id) > 0)
			throw new PermissionException("Form_Get");
		else
			throw new ArgumentException("Form not found");
 	}

	return result;
}
\end{lstlisting}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/PermissionException}
\caption[Ukázka neoprávnìného pøístupu]{Ukázka neoprávnìného pøístupu -- takto vypadá sdìlení o~neoprávnìném pøístupu na stránku èi provádìní neoprávnìné akce následované vznikem výjimky \icode{PermissionException}}
\label{fig:PermissionException}
\end{center}
\end{figure}

%*****************************************************************************
\chapter{Testování}


\section{Unit testy}

Ovìøení funkènosti hlavních tøíd a~jejich metod je provedeno pomocí Unit testù. Protože se testují hlavnì metody pro práci s~daty, je vytvoøena testovací databáze speciálnì pro tyto úèely, aby nedocházelo k~možným nekonzistentním datùm a~zásahùm do databáze ostré.

Pro implementaci Unit testù využívám nástrojù integrovaných ve Visual Studiu.

\section{Selenium testy}
\label{sec:Selenium testy}

Pomocí testovacího systému Selenium~\cite{Selenium} testuji aplikaci z~pohledu uživatele. Selenium je systém, který ve spuštìném webovém prohlížeèi vyvolává pøedem definované akce, jako je klikání na tlaèítka a~vkládání textù do pøíslušných polí. Lze také ovìøovat stavy jednotlivých HTML elementù a~mnoho dalšího. Tento testovací systém tedy simuluje chování uživatele pøi užívání systému. Díky tìmto testùm je ovìøìn jak obsah uživatelského rozhraní (dostupné akce a~údaje), tak i~samotné výsledky vyvolaných akcí.

Selenium mimo jiné umožòuje pøímou integraci do projektu vyvíjeného systému. Poskytuje totiž \CSharp~knihovny, skrze které lze události v~prohlížeèi vyvolávat. Testy jsem zapojil do testù podporovaných Visual Studiem. To pøineslo obrovskou výhodu, protože testy staèí spustit stejnì jako Unit testy a~tím se vytvoøí instance prohlížeèe a~zapoène simulace chování uživatele. Ihned je tvoøen report s~úspìchy a~neúspìchy jednotlivých dílèích testù.

Samotné scénáøe Selenium testù není nutné psát celé ruènì v~kódu. Základ lze velice jednoduše vygenerovat automaticky -- staèí zapnout nahrávání akcí ve webovém prohlížeèi a~chovat se jako uživatel. Nahraný scénáø události se poté vyexportuje do jednoho z~podporovaných jazykù, v~mém pøípadì do \CSharp. Jediný malý nedostatek je, že kód je generován pro NUnit\footnote{Open source framework pro testování v~.NET~\cite{NUnit}} testy, takže je ho tøeba naportovat pro testy integrované do VS.

\section{Výkonové testy}

\subsection{Aplikace}

V~souèasné dobì vychází výkonové testování aplikace pouze z~pozorování a~zpìtné odezvy od uživatelù pøi pilotním provozu, popsaným níže v~\ref{sec:Pilotní provoz}.

Pøi pilotním provozu systém obsahoval 46 aktivních uživatelù, z~toho bylo vždy cca 15 studentù online. Jejich aktivitou vzniklo 79 instancí formuláøù s~538 instancemi otázek a~518 odpovìïmi. Pøi takovémto nízkém poètu dat nelze oèekávat snížení výkonu dotazy do databáze, ale lze pozorovat celkovou plynulost aplikace pøi dotazech na server a~bìhu skriptù na klientském poèítaèi. Z~mého pohledu nedocházelo k~žádným problémùm a~potvrdili mi to i~uživatelé, na škále 1-5 (jako známkování ve škole) je výsledný prùmìr hodnocení 1,3.


\subsection{Databáze}

Pro testování a~nalezení neoptimalizovaných a~zbyteèných dotazù do databáze je dobré využít SQL Server Profiler~\cite{SQLServerProfiler}, který je souèástí SQL Server Performance Tools. Pøi použití Entity Frameworku se stává, že dotazy do databáze nejsou vždy zcela optimální. Dùvodem je, že EF neporozumí pøesnì zámìru programátora (což tøeba ani nemùže), a~napøíklad namísto jednoho dotazu s~JOIN pošle zvláš dotaz pro každý záznam v~tabulce. Díky profileru lze tyto dotazy jednoduše najít a~odpovìdný kód upravit.

V~tomto projektu jsem zatím SQL profileru nevyužil, ale je to jedna z~vìcí, které se budu v~brzké dobì vìnovat. V~tuto chvíli není totiž optimalizace dotazù do DB stìžejní. Na jednotlivých stránkách aplikace teoreticky není nic, co by mohlo i~v~nejhorším pøípadì systém viditelným zpùsobem zpomalit, což se potvrdilo pøi pilotním testování. Ovšem lepší je všechny dotazy optimalizovat ještì pøed tím, než se bude systém dále rozrùstat a~plnit velkým množstvím dat.

\section{Pilotní provoz}
\label{sec:Pilotní provoz}

Pilotní provoz probíhal za asistence mých studentù gymnázia (vìk 16-18 let). Nìkteøí vyzkoušeli pøipravený nauèný test s~tématem Základy programování a~nìkteøí vyplnili ostrý test ze základù poèítaèových sítí, který jim byl následnì oznámkován. Nakonec byli všichni požádáni o~vyplnìní dotazníku ohlednì názoru na systém.

Studentùm byly poskytnuty informace o~adrese portálu a~pøihlašovacích údajích. Poté byli studenti struènì instruováni aby vyplnili dostupný test. Myslím, že se v~systému bez problému zorientovali a~dostali se ke spuštìní vyplòování formuláøe. Zde ale nastal menší problém, který vyžadoval mou asistenci. Firefox totiž blokoval otevírané okno s~formuláøem, takže bylo nutné øíci studentùm o~nutnosti odblokovat otevírání oken a~jak to skrze nenápadnou a~podivnou nabídku provést. Samotné vyplòování formuláøù už bylo zcela bezproblémové.

Po vyplnìní ostrého testu se studentùm líbilo, že si ihned mohli prohlédnout svùj výsledek (po zobrazení vyplnìného testu vidìli správné odpovìdi vyznaèené zelenì a~špatné èervenì).

\clearpage

Výsledky dotazníku jsou myslím pro systém dobré. Z~výsledkù vyplývá, že je potøeba zapracovat na designu stránek, zatímco uživatelskou pøívìtivost (zde pro roli studenta) se, myslím, podaøilo splnit. Dotazník byl vyplnìn 37 studenty, otázky s~jejich výsledky jsou zde:
\\\\
\noindent
\textbf{Otázka:} Jak hodnotíte uživatelskou prívìtivost? Tzn. jak se v~portálu vyznáte, jak jsou jasné názvy položek menu, jednoduchost stránek, ...\\
\textbf{Možné odpovìdi:} 1, 2, 3, 4, 5 (hodnocení jako ve škole)\\
\textbf{Výsledek:} prùmìr 1,84
\\\\
\noindent
\textbf{Otázka:} Jak hodnotíte design stránek a~testù?\\
\textbf{Možné odpovìdi:} 1, 2, 3, 4, 5 (hodnocení jako ve škole)\\
\textbf{Výsledek:} prùmìr 2,4
\\\\
\noindent
\textbf{Otázka:} Jak hodnotíte rychlost aplikace? Tzn. jak rychle se naèítají jednotlivé stránky, jak je plynulá celková práce s~aplikací.\\
\textbf{Možné odpovìdi:} 1, 2, 3, 4, 5 (hodnocení jako ve škole)\\
\textbf{Výsledek:} prùmìr 1,38
\\\\
\noindent
\textbf{Otázka:} Chtìl/a~byste tento e-learningový systém používat pøi výuce?\\
\textbf{Možné odpovìdi:} Ano, Nevím, Ne\\
\textbf{Výsledek:} Ano 62\%, Nevím 35\%, Ne 3\%
\\\\
\noindent
\textbf{Otázka:} Máte radši papírové nebo elektronické testy/písemky?\\
\textbf{Možné odpovìdi:} Papírové, Elektronické\\
\textbf{Výsledek:} Papírové 32\%, Elektronické 68\%

\subsection{Testovací portál}
\label{subs:Testovací portál}

Testovací portál je dostupný na adrese \textbf{http://elearning.robertsojak.cz/}, kde bude dostupný nejménì do obhajoby této práce. Pøihlašovací údaje jsou následující:
\begin{itemize}
\item Administrátor -- E-mail \textbf{admin@admin.admin}, heslo \textbf{Pass123}
\item Lektor -- E-mail \textbf{lector@lector.lector}, heslo \textbf{Pass123}
\item Student ve skupinì lektora -- E-mail \textbf{studentL@studentL.studentL}, heslo \textbf{Pass123}
\end{itemize}

%*****************************************************************************
\chapter{Nasazení}
\label{chp:Nasazení}

Nasazení aplikace je patrné z~obrázku~\ref{fig:Diagram nasazení}. Uživatel potøebuje internetový prohlížeè se zapnutou podporou Javascriptu. Jeho pomocí se pøipojuje k~serveru, na kterém je nasazena aplikace.

Pro správný bìh aplikace musí být na serveru nainstalován .NET Framework verze alespoò 4.0. Jako datové uložištì aplikace požaduje databázový server Microsoft SQL Server verze alespoò 2005. Databázový server mùže být nasazen i~na vzdáleném serveru.

Popis postupu nasazení a~instalace uvádím v~instalaèní pøíruèce v~pøíloze~\ref{appendix:Instalaèní pøíruèka}.

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/DeploymentDiagram}
\caption[Diagram nasazení]{Diagram nasazení -- klientské zaøízení s~webovým prohlížeèem a~server s~.NET frameworkem a~SQL databází}
\label{fig:Diagram nasazení}
\end{center}
\end{figure}

%*****************************************************************************

\chapter{Závìr}

V~této bakaláøské práci jsem vytvoøil funkèní základ e-learningového portálu s~nìkterými specifickými požadavky zadavatele (\ref{subs:Požadavky zadavatele}). Systém byl poté úspìšnì otestován v~pilotním provozu (\ref{sec:Pilotní provoz}) , ve kterém byl shledán provozuschopným.

Na základì pilotního provozu se domnívám, že systém splòuje specifikované požadavky (\ref{sec:Požadavky na systém}) a~oèekávání. Jedním z~hlavních požadavkù bylo jednoduché ovládání, ozn. jako NP\ref{NP:Jednoduché ovládání, pochopitelné pro bìžného uživatele i bez zaškolení}. Jak vyplynulo z~ohlasu uživatelù, byl splnìn na lepší dvojku (známkování jako ve škole). Osobnì si myslím, že hodnocení bylo negativnì ovlivnìno chováním otevíraného okna formuláøe v~použitém prohlížeèi (popsáno v~sekci \ref{sec:Pilotní provoz}), protože pro úspìšné vyplnìní dostupných formuláøù a~prohlédnutí si výsledkù nebyly nutné žádné další pokyny. Nepøíjemnost s~otevíranými okny se tedy pokusím vyøešit a~poté už, myslím, nic nebrání dostat se na jednièku.

Pøi práci na tomto projektu jsem se nauèil vyvíjet s~použitím technologie ASP.NET MVC (\ref{subs:ASP.NET MVC 4.0}), což pro mne byla zajímavá zmìna oproti ASP.NET Windows Forms. Také jsem si osvojil využívání Selenium testování (\ref{sec:Selenium testy}), které bude zcela jistì výborným pomocníkem ve všech mých starých i~nových webovì orientovaných aplikacích.

\section{Další vývoj}
\label{sec:Další vývoj}

S~dalším vývojem systému se chystám použít metodu dog fooding\footnote{Metoda vývoje, kdy programátoøi používají vyvíjený software v~roli koncového uživatele}. Bìhem užívání pøi výuce se budou jistì stále rodit nové požadavky a~nápady, které se objevovaly již i~bìhem analýzy a~vývoje. Také je pravdìpodobné, že pøi ostrém provozu nebudou nìkterá chování systému pøesnì odpovídat chování požadovanému, které pøi analýze bez testování v~provozu na vìtším poètu uživatelù nelze nikdy pøedpovídat.

Zcela urèitì bude žádoucí napøíklad vylepšení rozhraní pro vytváøení formuláøù technologií AJAX~\cite{AJAX} a~dalšími klientskými skripty, aby nebylo nutné pøi každé úpravì otázky potvrzovat zmìnu stiskem tlaèítka. Také se chci vìnovat notifikacím pomocí e-mailu, které mohou být využity k~informování o~novém dostupném formuláøi èi udìlené známce.

V~implementaci systému v~tuto chvíli chybí øádné logování vzniklých chyb. To je dùležité pro každou aplikaci, protože a se programátoøi a~testeøi snaží sebevíc, nikdy nebude zcela bez chyb. Jejich zaznamenávání alespoò vede k~neustálému dohledu.

Pøi dalším vývoji také poèítám s~vylepšením celkového designu portálu a~úpravou nìkterých problematických míst v~kaskádních stylech. Hlavnì v~Internet Exploreru totiž nìkteré stránky nevypadají zcela správnì. Optimalizace pro všechny prohlížeèe pøesahovala rozsah dosavadního vývoje a~je mnohem produktivnìjší svìøit kódovaní vzhledu stránek specializovanému vývojáøi.

\section{Možná rozšíøení}

Zde uvádím výèet možných rozšíøení a~nápadù, které by v~budoucnu mohly systém vylepšit a~rozšíøit na víceúèelový e-learningový portál.

\subsection{Formuláøe}

\begin{itemize}
\item Pøidání vlastnosti Generovaný poèet otázek -- instance formuláøe bude vygenerována jen s~urèitým poètem náhodnì zvolených otázek
\item Možnost zadání stupnice pro automatické známkování -- instance formuláøe by tak mohla být automaticky oznámkována ihned po vyplìní (napø. podle procentuální úspìšnosti)
\item Možnost nastavit rozsah platnosti formuláøe -- formuláø bude dostupný pouze v~zadaném èasovém rozsahu
\item Umožnìní vyplnìní formuláøe i~neregistrovanému uživali -- tím by vznikla možnost využít systém napøíklad pro výzkum pomocí anonymních dotazníkù
\end{itemize}

\subsection{Otázky}
\label{sec:Možná rozšíøení sub:Otázky}

\begin{itemize}
\item Možnost pøiøadit k~textu otázky a~vysvìtlení správné odpovìdi obrázek
\item Nastavení bodového ohodnocení za správnou/špatnou odpovìï
\end{itemize}

\subsection{Skripta}

\begin{itemize}
    \item Možnost nahrání obrázku nebo jiného materiálu, napø. prezentace
\end{itemize}

\subsection{Reportování výsledkù formuláøe}

Reportování celkových výsledkù formuláøe je v~souèasné dobì možné pomocí externích nástrojù po exportu do Google Dokumentù. Urèitì by bylo dobré generovat reporty také pøímo v~aplikaci. Solidní základ je již v~implementaci pøipravený, staèí jen na základì dostupných údajù report vygenerovat a~zobrazit.

\subsection{E-mailové notifikace}

O~e-mailových notifikacích jsem se již zmínil výše. Jistì by velkou mìrou pøispìly k~efektivitì práce. Studentovi by odpadla nutnost neustále sledovat zmìny v~dostupných testech, udìlelených známkách a~další.


%*****************************************************************************

\bibliographystyle{csplainnat}

\bibliography{reference}


%*****************************************************************************
%*****************************************************************************
\appendix

%*****************************************************************************

\chapter{Seznam použitých zkratek}

\begin{description}
\item[LAN] Local Area Network
\item[MITM] Man In The Middle
\item[HTTP] HyperText Transfer Protocol
\item[HTTPS] HyperText Transfer Protocol Secure
\item[IS] Informaèní Systém
\item[GPL] General Public License
\item[MVC] Model View Controller
\item[CRUD] Create Read Update Delete
\item[VS] Visual Studio
\item[EF] Entity Framework
\item[UML] Unified Modeling Language
\item[DB] Databáze
\item[ORM] Object/Relational Mapping
\item[SQL] Structured Query Language
\item[HTML] HyperText Markup Language
\item[CSS] Cascading Style Sheets
\item[FTP] File Transfer Protocol
\item[AJAX] Asynchronous JavaScript and XML
\item[XML] Extensible Markup Language
\end{description}
\vdots

%*****************************************************************************

\chapter{UML}

\section{Popis pøípadù užití}
\label{appendix:Pøípady užití}

\noindent
\sectionline
\textbf{Název:} Pøíhlásit se do systému\\
\textbf{Aktéøi:} Student, Lektor, Administrátor\\
\textbf{Hlavní scénáø:}
\begin{enumerate}
\item Uživatel otevøe stránky systému pomocí webového prohlížeèe
\item Uživatel zvolí Pøíhlásit se
\item Systém zobrazí formuláø pro zadání pøihlašovacích údajù
\item Uživatel zadá pøihlašovací údaje a~potvrdí stiskem tlaèitka Pøihlásit se
\item Systém zobrazí domácí obrazovku uživatele
\end{enumerate}
\textbf{Alternativní scénáø 1:} Uživatel zadá špatné pøihlašovací údaje v~bodì 4
\begin{enumerate}
\setcounter{enumi}{4}
\item Systém zobrazí chybové hlášení
\item Pokraèuje se bodem 4
\end{enumerate}
\textbf{Výsledek:} Uživatel je pøihlášen do systému

\noindent
\sectionline %-----------------------------------------------------------------
\textbf{Název:} Vytvoøit nový formuláø\\
\textbf{Aktéøi:} Lektor, Administrátor\\
\textbf{Vstupní podmínky:} 
\begin{itemize}
\item Uživatel je pøihlášen do systému
\end{itemize}
\textbf{Hlavní scénáø:}
\begin{enumerate}
\item Uživatel zvolí Vytvoøit nový formuláø
\item Systém zobrazí formuláø pro zadání parametrù vytváøeného formuláøe
\item Uživatel zadá požadované parametry a~potvrdí tlaèítkem Vytvoøit
\item Systém vytvoøí nový formuláø na základì zadaných parametrù
\item Systém zobrazí obrazovku pro práci s~otázkami vytvoøeného formuláøe
\end{enumerate}
\textbf{Alternativní scénáø 1:} Uživatel zadá špatné parametry v~bodì 3
\begin{enumerate}
\setcounter{enumi}{3}
\item Systém zobrazí chybové hlášení o~špatnì vložených parametrech
\item Pokraèuje se bodem 3
\end{enumerate}
\textbf{Alternativní scénáø 2:} Uživatel zruší vytváøení formuláøe zvolením jiné akce\\
\textbf{Výsledek:} Systém obsahuje nový formuláø

\noindent
\sectionline %-----------------------------------------------------------------
\textbf{Název:} Pøidat otázku\\
\textbf{Aktéøi:} Lektor, Administrátor\\
\textbf{Vstupní podmínky:} 
\begin{itemize}
\item Uživatel je pøihlášen do systému
\item v~systému existuje formuláø ve stavu Neaktivní editovatelný nebo Aktivní nevyplnìný
\end{itemize}
\textbf{Hlavní scénáø:}
\begin{enumerate}
\item Uživatel zvolí formuláø, ke kterému chce otázku pøidat
\item Systém zobrazí obrazovku pro práci s~otázkami zvoleného formuláøe
\item Uživatel zvolí požadovaný typ otázky a~stiskne tlaèítko Pøidat
\item Systém pøidá do kolekce otázek formuláøe novou otázku zvoleného typu
\end{enumerate}
\textbf{Výsledek:} Formuláø obsahuje novou otázku

\noindent
\sectionline %-----------------------------------------------------------------
\textbf{Název:} Vyplnit formuláø\\
\textbf{Aktéøi:} Student\\
\textbf{Vstupní podmínky:} 
\begin{itemize}
\item Uživatel je pøihlášen do systému
\item V~systému existuje formuláø ve stavu Aktivní nevyplnìný nebo Aktivní vyplnìný
\item Formuláø je pøiøazen do stejné skupiny jako uživatel
\item Formuláø byl uživatelem vyplnìn ménìkrát než je jeho maximální poèet vyplnìní
\end{itemize}

\clearpage

\textbf{Hlavní scénáø:}
\begin{enumerate}
\item Uživatel zvolí formuláø k~vyplnìní
\item Systém zobrazí detailní informace o~vybraném formuláøi
\item Uživatel spustí vyplòování stiskem tlaèítka Start
\item Systém vygeneruje instanci formuláøe na základì jeho parametrù
\item Systém skryje hlavní ovládací prvky a~zobrazí vygenerovaný formuláø
\item Uživatel vyplní své odpovìdi na otázky formuláøe
\item Uživatel potvrdí odpovìdi stiskem Odeslat
\item Systém odpovìdi zaznamená, potvrdí pøijetí a~opìt zobrazí hlavní ovládací prvky
\end{enumerate}
\textbf{Alternativní scénáø 1:} Vypršel èasový limit formuláøe bìhem vyplòování v~bodì 6
\begin{enumerate}
\setcounter{enumi}{6}
\item Systém ukonèí vyplòování formuláøe
\item Pokraèuje se bodem 8 hlavního scénáøe
\end{enumerate}
\textbf{Výsledek:} Systém obsahuje novou instanci formuláøe s~odpovìïmi na otázky

\noindent
\sectionline %-----------------------------------------------------------------
\textbf{Název:} Exportovat výsledky formuláøe do Google Dokumentù\\
\textbf{Aktéøi:} Lektor, Administrátor\\
\textbf{Vstupní podmínky:} 
\begin{itemize}
\item Uživatel je pøihlášen do systému
\item V~systému existuje formuláø
\end{itemize}
\textbf{Hlavní scénáø:}
\begin{enumerate}
\item Uživatel zvolí zobrazení výsledkù formuláøe k~exportu
\item Systém zobrazí pøehled vyplnìní formuláøe
\item Uživatel stiskne tlaèítko Export výsledkù do Google Dokumentù
\item Systém zobrazí formuláø pro zadání pøihlašovacích údajù Google úètu
\item Uživatel vyplní údaje a~potvrdí export stiskem Exportovat
\item Systém exportuje výsledky do nového dokumentu v~zadaném Google úètu
\end{enumerate}
\textbf{Výsledek:} Uživatelùv Google úèet obsahuje nový dokument s~výsledky formuláøe

\noindent
\sectionline %-----------------------------------------------------------------

%*****************************************************************************
\chapter{Instalaèní pøíruèka}
\label{appendix:Instalaèní pøíruèka}

Zde uvádím popis instalace (nasazení) aktuální verze aplikace asi nejjednodušším zpùsobem, a~to za využití Visual Studia. Pro úspìšné nasazení je tøeba mít k~dispozici aplikaèní a~databázový server, jak je uvedeno v~kapitole~\ref{chp:Nasazení}.

Nejdøíve je tøeba zvolit konfiguraci pro zveøejòování, tzn. Release nebo nìkterou z~mnou pøedpøipravených. Na obrázku~\ref{fig:Volba konfigurace pro nasazení} je zachycena volba konfigurace pro nasazení na ukázkový server projektu~(\ref{subs:Testovací portál}).

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.6\textwidth]{figures/InstallGuide_Configuration}
\caption[Volba konfigurace pro nasazení]{Volba konfigurace pro nasazení na ukázkový server v~prostøedí Visual Studia}
\label{fig:Volba konfigurace pro nasazení}
\end{center}
\end{figure}

Pro nasazení databáze je tøeba nejprve zkontrolovat nastavení databázového projektu. Akce pro Deployment by mìla být nastavena na vytvoøení skriptu a~automatické vytvoøení databáze, jak je vidìt na obrázku~\ref{fig:Nastavení databázového projektu}. v~poli \textit{Target connection} by mìly být vyplnìny údaje nutné k~pøipojení k~požadovanému DB serveru a~v~poli \textit{Target database name} jméno vytváøené databáze. Po kontrole údajù staèí jen vybrat v~menu \textit{Build}~\textrightarrow~\textit{Deploy Database} a~celá databáze i~s~poèáteèními daty bude automaticky nasazena.

\clearpage

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/InstallGuide_DBSettings}
\caption[Nastavení databázového projektu]{Stránka pro nastavení databázového projektu s~vyznaèeným nastavením, které vyžaduje pozornost}
\label{fig:Nastavení databázového projektu}
\end{center}
\end{figure}

Nasazení samotného portálu je stejnì jednoduché. Po vybrání projektu \textit{ELearning} je v~menu \textit{Build} zpøístupnìna akce \textit{Publish ELearning}. Vyvolané dialogové okno je vidìt na obrázku~\ref{fig:Diagram pro publikování aplikace}. k~nasazení je využito metody \textit{FTP}, která nahrává aplikaèní soubory pøes FTP spojení na zadanou adresu. Po vyplnìní pøístupových údajù a~stisku tlaèítka \textit{Publish} dojde k~nasazení aplikace.

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.6\textwidth]{figures/InstallGuide_Publish}
\caption[Dialog pro publikování aplikace]{Dialog pro publikování aplikace s~vyznaèenou volbou metody publikace a~pøístupových údajù}
\label{fig:Diagram pro publikování aplikace}
\end{center}
\end{figure}

%*****************************************************************************

\chapter{Unity Application Block tutoriál}

Pro dependency injection do controllerù využívám NuGet balíèku Unity Application Block. Zde bych chtìl pøiblížit, jak jej zaèlenit do projektu.

Dependency injection je návrhový vzor pro napojení závislostí tøídy zvenèí, což je opak k~tomu, když své závislosti øeší tøída sama. K~pøedávání tìchto závislostí se využívá specializované tøídy, což umožòuje pøi zámìnì konkrétní implementace provést výmìnu pouze na jednom místì. Konkrétní objekty se závislé tøídì vìtšinou pøedávají v~konstruktoru nebo pomocí veøejných vlastností.

Pro využití Unity Application Block je nejdøíve nutné nainstalovat do projektu Unity NuGet balíèek (v~menu Visual Studia zvolit \textit{Tools}~\textrightarrow~\textit{Library Package Manager}~\textrightarrow~\textit{Manage NuGet Packages...}, v~dialogovém oknì vyhledat \textit{Unity} a~potvrdit instalaci).

Pro pøístup k~Unity definuji podobnì jako v~\cite{HowToUseUnityContainer} interface \icode{IUnityContainerAccessor} s~následujícím pøedpisem:

\begin{lstlisting}[caption={[Pøedpis rozhraní \icode{IUnityContainerAccessor}]Pøedpis rozhraní \icode{IUnityContainerAccessor} sloužící pro pøístup k~Unity bloku}]
public interface IUnityContainerAccessor
{
	IUnityContainer UnityContainer { get; }
}
\end{lstlisting}

Vytvoøený interface poté lze pøidat do implementace tøídy aplikace \icode{MvcApplication}, která je umístìna v~souboru Global.asax.cz. Zpùsob implementace je patrný z~tohoto kódu:

\begin{lstlisting}[caption={[Ukázka implementace \icode{IUnityContainerAccessor} ve tøídì \icode{MvcApplication}]Ukázka implementace \icode{IUnityContainerAccessor} ve tøídì \icode{MvcApplication} zajišuje globální dostupnost Unity bloku}]
public class MvcApplication : System.Web.HttpApplication, IUnityContainerAccessor
{
	public static IUnityContainer UnityContainer
	{
		get { return _unityContainer; }
	}
	private static IUnityContainer _unityContainer;
	...
	protected void Application_Start()
	{
		...
		InitUnity();
	}
	...
	private static void InitUnity()
	{
		var unityContainerFactory = new UnityContainerFactory();
		_unityContainer = unityContainerFactory.CreateContainer();
		ControllerBuilder.Current.SetControllerFactory(typeof(UnityControllerFactory));
	}
	...
	IUnityContainer IUnityContainerAccessor.UnityContainer
	{
		get { return _unityContainer; }
	}
}
\end{lstlisting}

Dále je tøeba vytvoøit potomka tøídy \icode{DefaultControllerFactory} s~pøetíženou metodou \icode{CreateController} a~\icode{GetControllerInstance}, který nahradí základní controller factory~\cite{ASPNETMVCandUnity}. Právì ten bude zajišovat dependency injection pro každý controller aplikace. v~metodì \icode{CreateController} je využito instance aplikace k~získání instance \icode{UnityContainer}:

\begin{lstlisting}[caption={[Tøída \icode{UnityControllerFactory}]Tøída \icode{UnityControllerFactory}, která nahradí výchozí controller factory}]
public class UnityControllerFactory : DefaultControllerFactory
{
	protected IUnityContainer _unityContainer;
	...
	public override IController CreateController(System.Web.Routing.RequestContext requestContext, string controllerName)
	{
		IUnityContainerAccessor accessor = requestContext.HttpContext.ApplicationInstance as IUnityContainerAccessor;
		_unityContainer = accessor.UnityContainer;

		return base.CreateController(requestContext, controllerName);
	}

	protected override IController GetControllerInstance(System.Web.Routing.RequestContext requestContext, Type controllerType)
	{
		if (controllerType == null)
			return null;

		return _unityContainer.Resolve(controllerType) as IController;
	}
}
\end{lstlisting}

Posledním krokem je vytvoøení samotné \icode{UnityContainerFactory}. v~té je tøeba provést registraci jednotlivých konkrétních implementací požadovaných tøíd a~rozhraní pro injekci. Následující kód ukazuje pøíklad takové registrace:

\begin{lstlisting}[caption={[Pøíklad registrace rozhraní pro injekci v~\icode{UnityContainerFactory}]Pøíklad registrace rozhraní pro injekci v~\icode{UnityContainerFactory}, tøídy lze registrovat stejným zpùsobem}]
public class UnityContainerFactory
{
	...
	public virtual IUnityContainer CreateContainer()
	{
		UnityContainer result = new UnityContainer();
		// Registers injection of class WebAuthenticationContext in
		//  place of interface IAuthenticationContext
		result.RegisterType<IAuthenticationContext, WebAuthenticationContext>();

		return result;
	}
	...
}
\end{lstlisting}

Tím je celý Unity blok zanesen do aplikace a~pøipraven k~použití. Pøíklad použití v~controlleru uvádím v~následující ukázce:

\begin{lstlisting}[caption={[Pøíklad použití dependency injection v~controlleru]Pøíklad použití dependency injection v~controlleru pro injekci implementace rozhraní \icode{IAuthenticationContext}}]
public class BaseController : Controller
{
	[Dependency]
	public IAuthenticationContext AuthenticationContext { get; set; }
	...
}
\end{lstlisting}

%*****************************************************************************
\chapter{Obrazová pøíloha}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/MoodleQuestionTypes}
\caption[Typy otázek v systému Moodle]{Typy otázek v~systému Moodle~\cite{MoodleVycetTypuOtazek}}
\label{fig:Typy otázek v systému Moodle}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/Screenshot_StudentHome}
\caption[Screenshot aplikace -- Hlavní stránka studenta]{Screenshot aplikace -- Hlavní stránka studenta}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/Screenshot_StudentTest}
\caption[Screenshot aplikace -- Vyplòování testu]{Screenshot aplikace -- Vyplòování testu}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/Screenshot_StudentLearningTest}
\caption[Screenshot aplikace -- Vyplòování nauèného testu]{Screenshot aplikace -- Vyplòování nauèného testu}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=1\textwidth]{figures/Screenshot_LectorTestCreation}
\caption[Screenshot aplikace -- Tvorba formuláøe lektorem]{Screenshot aplikace -- Tvorba formuláøe lektorem}
\end{center}
\end{figure}

\begin{figure}[h]
\begin{center}
\includegraphics[width=0.9\textwidth]{figures/PrintedTest}
\caption[Ukázka tisku papírové verze formuláøe]{Ukázka tisku papírové verze formuláøe}
\end{center}
\end{figure}

%*****************************************************************************
\chapter{Obsah pøiloženého CD}

\begin{itemize}
\item[] \icode{[bin]} -- adresáø s aplikací urèenou k~distribuci
\item[] \icode{[doc]} -- dokumentace ke zdrojovému kódu aplikace
\item[] \icode{[help]} -- adresáø s uživatelským manuálem
\item[] \icode{[src]} -- zdrojový kód aplikace pro prostøedí Visual Studia 2010
\item[] \icode{[text]} -- elektronická verze tohoto dokumentu a jeho zdrojové soubory
\item[] \icode{readme.txt} -- popis instalace aplikace a obsah CD
\end{itemize}

%*****************************************************************************
\end{document}
